
<!DOCTYPE html>
<html dir="rtl">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>سرزمین تجارت</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

	<link href="~/Css/fontawesome-all.min.css" rel="stylesheet" />
	<link href="~/Css/iofrm-style-1.css" rel="stylesheet" />
	<link href="~/Css/iofrm-theme17.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

</head>
<body style="font-family:'B Yekan'">
	<div class="form-body without-side">

		<div class="row">
			<div class="img-holder">
				<div class="bg"></div>
				<div class="info-holder">

					<img src="~/image/graphic3.svg" />
				</div>
			</div>
			<div class="form-holder">
				<div class="form-content">
					<div class="form-items">
						<h3>ورود به اکانت</h3>
						<p style="font-family:'B Yekan'">با ورود به اکانت خود به مدیریت حساب خود برسید</p>
						<form action="/User/SignIn" method="post">
							@{
								<input type="text" id="Mobile" name="Mobile" class="form-control" placeholder="شماره همراه را وارد کنید">
							}

							<input type="password" id="Password" name="Password" class="form-control" placeholder="کد پیامک شده را وارد کنید" hidden>
							<div class="form-button">
								<button id="btnsumbit" onclick="PostVerifyCodeAjax()" type="button" class="ibtn" hidden>ورود</button>
								<button style="font-family:'B Yekan'" id="btnrequestcode" onclick="RequestCode();" type="button" class="ibtn">درخواست کد ورود</button>
								<button type="button" id="btnretry" onclick="tryagain()" class="btn btn-color-reverse btn-full" hidden>
									<span id="countdown" class="timer"></span>
									تلاش مجدد
								</button>
							</div>
							<div class="text text-center" style="margin-top:20px">

								<a href="../User/Register"><small style="font-family:'B Yekan'">حساب کاربری ندارید؟ثبت نام کنید</small></a>
							</div>
							<input type="hidden" name="Url" value="@Request["ReturnUrl"]" />
						</form>
						<div style="color:red;text-align:right">
							@Html.ValidationSummary()
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="SuccessModals" role="dialog">
		<div class="modal-dialog modal-sm">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header text-success" style="font-family:'B Yekan'">
					موفقیت آمیز
				</div>
				<div class="modal-body modal-success">
					<p style="font-family:'B Yekan+';text-align:right;" id="successtxt"></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-outline-dark" data-dismiss="modal" style="font-family:'B Yekan'">تایید</button>
				</div>
			</div>

		</div>
	</div>
	<div class="modal fade" id="ErrorModal" role="dialog">
		<div class="modal-dialog modal-sm">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header text-danger" style="font-family:'B Yekan'">
					خطا در ورود به سیستم
				</div>
				<div class="modal-body ">
					<p class="text-danger" style="font-family:'B Yekan';text-align:right;color:black;margin-right:5px;margin-top:5px" id="errortext"></p>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-dark" data-dismiss="modal" style="font-family:'B Yekan'">تایید</button>
				</div>
			</div>

		</div>
	</div>
	@*<script src="/Js/site/jquery-3.min.js"></script>*@
	<script src="/Js/site/popper.min.js"></script>
		@*<script src="/Js/site/bootstrap.min.js"></script>*@
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	@*<script src="js/main.js"></script>*@
</body>
</html>

<script>
	var seconds = 30;

	function tryagain() {
		seconds = 30;

		$("#btnretry").prop("disabled", true);
	    $('#countdown').attr("hidden",false);
		countdown();
		PostAjaxtryagain();

	}
	function RequestCode() {
		if ($("#Mobile").val() == "") {
			$("#errortext").text("شماره همراه خالی است");
			$('#ErrorModal').modal('show');
		}
		else {
	 var fd = new FormData();
		fd.append("Mobile", $('#Mobile').val());
        $.ajax({
        type: "POST", 
        url: "../User/SignIn",
        data: fd,
        dataType: "json",
        contentType: false,
        processData: false,   
        success: function (response) {
        if (response.success == false) {
		$("#errortext").text(response.responseText);
		$('#ErrorModal').modal('show');
		}
		if (response.success == true) {
		$("#successtxt").text("پیامک ارسال شد");
			$('#SuccessModals').modal('show');
			$('#Mobile').attr("hidden", true);
			$('#Password').attr("hidden", false);
			$('#btnsumbit').attr("hidden", false);
			$('#btnrequestcode').attr("hidden", true);
			$('#btnretry').attr("hidden", false);
		}
        },
        error: function (response) {
     
        }    
    });
		}

	}
		function PostVerifyCodeAjax() {
    var fd = new FormData();
		fd.append("Mobile", $('#Mobile').val());
		fd.append("Password", $('#Password').val());
    $.ajax({
        type: "POST", 
        url: "../User/SignIn",
        data: fd,
        dataType: "json",
        contentType: false,
        processData: false,   
        success: function (response) {
           	if (response.success == false) {
				$("#errortext").text(response.responseText);
				$('#ErrorModal').modal('show');
				}
			if (response.success == true) {

				if (response.responseText != null) {
					location.href = response.responseText;
				}
				else {
					location.href = "../Home/Index"; 
				}
				}
        },
        error: function (response) {
            $("#LoadingModal").modal('show');
        }    
    });
	}
		function PostAjaxtryagain() {
  var fd = new FormData();
		fd.append("Mobile", $('#Mobile').val());
    $.ajax({
        type: "POST", 
        url: "../User/SignIn",
        data: fd,
        dataType: "json",
        contentType: false,
        processData: false,   
        success: function (response) {
           	if (response.success == false) {
				$("#errortext").text(response.responseText);
				$('#ErrorModal').modal('show');
				}
				if (response.success == true) {
				$("#successtxt").text("پیامک مجددا ارسال شد");
				$('#SuccessModals').modal('show');
				}
        },
        error: function (response) {
     
        }    
    });
	}
	
    function secondPassed() {
	var minutes = Math.floor(seconds/60);
	var remainingSeconds = seconds % 60;
	if (remainingSeconds < 10) {
        remainingSeconds = "0" + remainingSeconds;  
    }
    document.getElementById('countdown').innerHTML = minutes + ":" + remainingSeconds;
   if (seconds == 0) {
			$("#btnretry").prop("disabled", false);
		    $('#countdown').attr("hidden",true);
		}
	}
	function countdown() {
		secondPassed();
		if (seconds != 0) {
			seconds--;
			countdownTimer = setTimeout('countdown()', 1000);
		}

	}

</script>
